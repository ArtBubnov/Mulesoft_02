name: deploy project to dev env

#this scenario can be triggered only by pr_run_munits_orchestration scenario
on:
  workflow_call:

jobs:
  dev:
    runs-on: ubuntu-latest
    #in the env section below variables for mulesoft project pom file for the following sections should be defined:  
    #1. build --> plugin (org.mule.tools.maven) --> cloudHubDeployment  
    #2. build --> plugin (org.mule.tools.maven) --> cloudHubDeployment --> properties 
    env:
    #POM <cloudHubDeployment>
      PLATFORM_USERNAME: artemBubnov
      PLATFORM_PASSWORD: mg5uGwRQ7XM2MeEb
      BUSINESSGROUPID: VRP Consulting
      ENV: Sandbox
      WORKERS: 1
      WORKERS_TYPE: Micro
      REGION: eu-central-1
      URI: https://eu1.anypoint.mulesoft.com
    steps:
      #This action checks-out your repository under $GITHUB_WORKSPACE
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: logger
        run: |
          echo "branches has been mertged"
          echo 'the following is targer branch: '$GITHUB_REF_NAME

      #This step performs:
      # 1. add new dependencies in cache
      # 2. retrieve existing data from cache 
      - name: Checking Cache
        uses: actions/cache@v3
        with:
          path: ~/.m2/repository
          key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}
          restore-keys: |
            ${{ runner.os }}-maven- 

      #This step deploys data to DEV Mulesoft env
      - name: test
        run: |
              TEST="force-app/main/default/classes/OSF_AccorToEurostarHistory_BatchJob.cls,force-app/main/default/classes/OSF_AccorToEurostar_BatchJob.cls,force-app/main/default/classes/OSF_AccorToEurostar_BatchJobScheduler.cls,force-app/main/default/classes/OSF_AccorToEurostar_BatchJobScheduler.cls-meta.xml,force-app/main/default/classes/OSF_AmexToEurostar_BatchJob.cls,force-app/main/default/classes/OSF_AmexToEurostar_BatchJobScheduler.cls,force-app/main/default/classes/OSF_AmexToEurostar_BatchJobScheduler.cls-meta.xml,force-app/main/default/classes/OSF_Compensation_TriggerHandler.cls,force-app/main/default/classes/OSF_EToAccorRespHistory_BatchScheduler.cls,force-app/main/default/classes/OSF_EToAccorRespHistory_BatchScheduler.cls-meta.xml,force-app/main/default/classes/OSF_EurostarToAccorRespHistory_BatchJob.cls,force-app/main/default/classes/OSF_EurostarToAccorRespHistory_BatchJob.cls-meta.xml,force-app/main/default/classes/OSF_EurostarToAccor_Batchjob.cls,force-app/main/default/classes/OSF_EurostarToAccor_BatchjobScheduler.cls,force-app/main/default/classes/OSF_EurostarToAccor_BatchjobScheduler.cls-meta.xml,force-app/main/default/classes/OSF_HertzToEurostar_BatchJob.cls,force-app/main/default/classes/OSF_HertzToEurostar_BatchJobScheduler.cls,force-app/main/default/classes/OSF_HertzToEurostar_BatchJobScheduler.cls-meta.xml,force-app/main/default/classes/OSF_LPMReset_BatchJobScheduler.cls,force-app/main/default/classes/OSF_LPMReset_BatchJobScheduler.cls-meta.xml,force-app/main/default/classes/OSF_LoyaltyMemberTier_TriggerHandler.cls,force-app/main/default/classes/OSF_LoyaltyProgramMemberReset_BatchJob.cls,force-app/main/default/classes/OSF_PackageSales_BatchJob.cls,force-app/main/default/classes/OSF_PackageSales_BatchJobScheduler.cls,force-app/main/default/classes/OSF_PackageSales_BatchJobScheduler.cls-meta.xml,force-app/main/default/classes/OSF_PackageTrigger_BatchJob.cls,force-app/main/default/classes/OSF_ProcessEDCSInput_BatchJob.cls,force-app/main/default/classes/OSF_ProcessEDCSInput_BatchJobScheduler.cls,force-app/main/default/classes/OSF_ProcessEDCSInput_BatchJobScheduler.cls-meta.xml,force-app/main/default/classes/OSF_REST_CloseMembershipAccount.cls,force-app/main/default/classes/OSF_REST_GetPointsTickets.cls,force-app/main/default/classes/OSF_REST_GetTicketsLinkedToMember.cls,force-app/main/default/classes/OSF_REST_PartnerPointTipping.cls,force-app/main/default/classes/OSF_REST_PointsAdjustment.cls,force-app/main/default/classes/OSF_REST_RedeemTicketExchanges.cls,force-app/main/default/classes/OSF_REST_RedeemTicketPointsDiscount.cls,force-app/main/default/classes/OSF_REST_RedeemTicketUpgrade.cls,force-app/main/default/classes/OSF_REST_RetroClaimPoints.cls,force-app/main/default/classes/OSF_REST_RollbackRedemption.cls,force-app/main/default/classes/OSF_REST_TicketPointsRedemption.cls,force-app/main/default/classes/OSF_RedTraindTicketPostProcess_BatchJob.cls,force-app/main/default/classes/OSF_Red_MembStatusExBatchScheduler.cls,force-app/main/default/classes/OSF_Red_MembStatusExBatchScheduler.cls-meta.xml,force-app/main/default/classes/OSF_Red_MembTierHistBatchScheduler.cls,force-app/main/default/classes/OSF_Red_MembTierHistBatchScheduler.cls-meta.xml,force-app/main/default/classes/OSF_Red_MemberPeriodExBatchScheduler.cls,force-app/main/default/classes/OSF_Red_MemberPeriodExBatchScheduler.cls-meta.xml,force-app/main/default/classes/OSF_Red_PointsAccrExtBatchScheduler.cls,force-app/main/default/classes/OSF_Red_PointsAccrExtBatchScheduler.cls-meta.xml,force-app/main/default/classes/OSF_Red_PointsExpExtracBatchJobScheduler.cls,force-app/main/default/classes/OSF_Red_PointsExpExtracBatchJobScheduler.cls-meta.xml,force-app/main/default/classes/OSF_Red_PointsSpendingExtBatchScheduler.cls,force-app/main/default/classes/OSF_Red_PointsSpendingExtBatchScheduler.cls-meta.xml,force-app/main/default/classes/OSF_Red_PointsTrExBatchScheduler.cls,force-app/main/default/classes/OSF_Red_PointsTrExBatchScheduler.cls-meta.xml,force-app/main/default/classes/OSF_Red_RedempExtBatchScheduler.cls,force-app/main/default/classes/OSF_Red_RedempExtBatchScheduler.cls-meta.xml,force-app/main/default/classes/OSF_Redshift_MemberExtBatchJobScheduler.cls,force-app/main/default/classes/OSF_Redshift_MemberExtBatchJobScheduler.cls-meta.xml,force-app/main/default/classes/OSF_Redshift_PointsExpiryExtrac_BatchJob.cls,force-app/main/default/classes/OSF_Redshift_PointsSpendingExtr_BatchJob.cls,force-app/main/default/classes/OSF_Redshift_PointsTransferExtr_BatchJob.cls,force-app/main/default/classes/OSF_Redshift_RedemptionsExtract_BatchJob.cls,force-app/main/default/classes/OSF_RegisterLoyaltyMemberRestResource.cls,force-app/main/default/classes/OSF_RegisterLoyaltyMemberRestResource.cls-meta.xml,force-app/main/default/classes/OSF_TestDataFactory.cls,force-app/main/default/classes/OSF_TestDataFactory.cls-meta.xml,force-app/main/default/classes/OSF_TicketCancelationHistory_BatchJob.cls,force-app/main/default/classes/OSF_TicketCancelationHistory_BatchJob.cls-meta.xml,force-app/main/default/classes/OSF_TicketCancelation_BatchJob.cls,force-app/main/default/classes/OSF_TicketCheckInHistory_BatchJob.cls,force-app/main/default/classes/OSF_TicketCheckInHistory_BatchJob.cls-meta.xml,force-app/main/default/classes/OSF_TicketCheckIn_BatchJob.cls,force-app/main/default/classes/OSF_TicketHandler.cls,force-app/main/default/classes/OSF_TicketSales_BatchJob.cls,force-app/main/default/classes/OSF_TicketSales_BatchJobScheduler.cls,force-app/main/default/classes/OSF_TicketSales_BatchJobScheduler.cls-meta.xml,force-app/main/default/classes/tests/OSF_AccorToEurostarHistory_BatchJobTest.cls,force-app/main/default/classes/tests/OSF_AccorToEurostarHistory_BatchJobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_AccorToEurostar_BatchJobTest.cls,force-app/main/default/classes/tests/OSF_AccorToEurostar_BatchJobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_AccorToEurostar_BatchSchedulerTest.cls,force-app/main/default/classes/tests/OSF_AccorToEurostar_BatchSchedulerTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_Account_TriggerHandlerTest.cls,force-app/main/default/classes/tests/OSF_Account_TriggerHandlerTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_AmexToEurostarHistory_BatchJobTest.cls,force-app/main/default/classes/tests/OSF_AmexToEurostarHistory_BatchJobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_AmexToEurostar_BatchJobSchedulerTest.cls,force-app/main/default/classes/tests/OSF_AmexToEurostar_BatchJobSchedulerTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_AmexToEurostar_BatchJobTest.cls,force-app/main/default/classes/tests/OSF_AmexToEurostar_BatchJobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_Compensation_TriggerHandlerTest.cls,force-app/main/default/classes/tests/OSF_Compensation_TriggerHandlerTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_EToARespHistory_BatchSchedulerTest.cls,force-app/main/default/classes/tests/OSF_EToARespHistory_BatchSchedulerTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_EurostarToAccorHistory_BatchJobTest.cls,force-app/main/default/classes/tests/OSF_EurostarToAccorHistory_BatchJobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_EurostarToAccorRespHist_BatchJobTest.cls,force-app/main/default/classes/tests/OSF_EurostarToAccorRespHist_BatchJobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_EurostarToAccor_BatchSchedulerTest.cls,force-app/main/default/classes/tests/OSF_EurostarToAccor_BatchSchedulerTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_EurostarToAccor_BatchjobTest.cls,force-app/main/default/classes/tests/OSF_EurostarToAccor_BatchjobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_HertzToEurostarHistory_BatchJobTest.cls,force-app/main/default/classes/tests/OSF_HertzToEurostarHistory_BatchJobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_HertzToEurostar_BatchJobTest.cls,force-app/main/default/classes/tests/OSF_HertzToEurostar_BatchJobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_HertzToEurostar_BatchSchedulerTest.cls,force-app/main/default/classes/tests/OSF_HertzToEurostar_BatchSchedulerTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_LPMReset_BatchJobSchedulerTest.cls,force-app/main/default/classes/tests/OSF_LPMReset_BatchJobSchedulerTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_LoyaltyMemberTier_TriggerHandlerTest.cls,force-app/main/default/classes/tests/OSF_LoyaltyMemberTier_TriggerHandlerTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_LoyaltyProgramMemberReset_BatchTest.cls,force-app/main/default/classes/tests/OSF_LoyaltyProgramMemberReset_BatchTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_LoyaltyProgramMember_TriggerHandTest.cls,force-app/main/default/classes/tests/OSF_LoyaltyProgramMember_TriggerHandTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_PackageSalesHistory_BatchJobTest.cls,force-app/main/default/classes/tests/OSF_PackageSalesHistory_BatchJobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_PackageSales_BatchJobSchedulerTest.cls,force-app/main/default/classes/tests/OSF_PackageSales_BatchJobSchedulerTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_PackageSales_BatchJobTest.cls,force-app/main/default/classes/tests/OSF_PackageSales_BatchJobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_PackageTriggerHistory_BatchJobTest.cls,force-app/main/default/classes/tests/OSF_PackageTriggerHistory_BatchJobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_PackageTrigger_BatchJobTest.cls,force-app/main/default/classes/tests/OSF_PackageTrigger_BatchJobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_ProcessEDCSInput_BatchJobTest.cls,force-app/main/default/classes/tests/OSF_ProcessEDCSInput_BatchJobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_ProcessEDCSInput_BatchSchedulerTest.cls,force-app/main/default/classes/tests/OSF_ProcessEDCSInput_BatchSchedulerTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_REST_CloseMembershipAccountTest.cls,force-app/main/default/classes/tests/OSF_REST_CloseMembershipAccountTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_REST_GetPointsStatementTest.cls,force-app/main/default/classes/tests/OSF_REST_GetPointsStatementTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_REST_GetPointsTicketsTest.cls,force-app/main/default/classes/tests/OSF_REST_GetPointsTicketsTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_REST_GetTicketsLinkedToMemberTest.cls,force-app/main/default/classes/tests/OSF_REST_GetTicketsLinkedToMemberTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_REST_LoyaltyMemberResgistration_Test.cls,force-app/main/default/classes/tests/OSF_REST_LoyaltyMemberResgistration_Test.cls-meta.xml,force-app/main/default/classes/tests/OSF_REST_LoyaltyPointsTransferTest.cls,force-app/main/default/classes/tests/OSF_REST_LoyaltyPointsTransferTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_REST_PartnerPointTippingTest.cls,force-app/main/default/classes/tests/OSF_REST_PartnerPointTippingTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_REST_PointsAdjustmentTest.cls,force-app/main/default/classes/tests/OSF_REST_PointsAdjustmentTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_REST_RedeemTicketPointsDiscountTest.cls,force-app/main/default/classes/tests/OSF_REST_RedeemTicketPointsDiscountTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_REST_RedeemTicketUpgradeTest.cls,force-app/main/default/classes/tests/OSF_REST_RedeemTicketUpgradeTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_REST_RetroClaimPointsTest.cls,force-app/main/default/classes/tests/OSF_REST_RetroClaimPointsTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_REST_RollbackRedemptionTest.cls,force-app/main/default/classes/tests/OSF_REST_RollbackRedemptionTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_REST_TicketPointsRedemptionTest.cls,force-app/main/default/classes/tests/OSF_REST_TicketPointsRedemptionTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_RedTraindTicketPostProcBatchJobTest.cls,force-app/main/default/classes/tests/OSF_RedTraindTicketPostProcBatchJobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_RedTraindTicketPostProcessBatchTest.cls,force-app/main/default/classes/tests/OSF_RedTraindTicketPostProcessBatchTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_Red_MembStatusExBatchSchedulerTest.cls,force-app/main/default/classes/tests/OSF_Red_MembStatusExBatchSchedulerTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_Red_MembTierHistBatchSchedulerTest.cls,force-app/main/default/classes/tests/OSF_Red_MembTierHistBatchSchedulerTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_Red_MemberPeriodExBatchSchedulerTest.cls,force-app/main/default/classes/tests/OSF_Red_MemberPeriodExBatchSchedulerTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_Red_PointExpExtBatchJobSchedulerTest.cls,force-app/main/default/classes/tests/OSF_Red_PointExpExtBatchJobSchedulerTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_Red_PointsAccrExtBatchSchedulerTest.cls,force-app/main/default/classes/tests/OSF_Red_PointsAccrExtBatchSchedulerTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_Red_PointsSpendExtBatchSchedulerTest.cls,force-app/main/default/classes/tests/OSF_Red_PointsSpendExtBatchSchedulerTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_Red_PointsTrExBatchSchedulerTest.cls,force-app/main/default/classes/tests/OSF_Red_PointsTrExBatchSchedulerTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_Red_RedempExtBatchSchedulerTest.cls,force-app/main/default/classes/tests/OSF_Red_RedempExtBatchSchedulerTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_RedshiftMembershipPeriodExBtchJobTst.cls,force-app/main/default/classes/tests/OSF_RedshiftMembershipPeriodExBtchJobTst.cls-meta.xml,force-app/main/default/classes/tests/OSF_RedshiftPointsAccrualExtraBatch_Test.cls,force-app/main/default/classes/tests/OSF_RedshiftPointsAccrualExtraBatch_Test.cls-meta.xml,force-app/main/default/classes/tests/OSF_Redshift_MemberBatchJob_Test.cls,force-app/main/default/classes/tests/OSF_Redshift_MemberBatchJob_Test.cls-meta.xml,force-app/main/default/classes/tests/OSF_Redshift_MemberExtBatchSchedulerTest.cls,force-app/main/default/classes/tests/OSF_Redshift_MemberExtBatchSchedulerTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_Redshift_MemberExtractionBatchJobTst.cls,force-app/main/default/classes/tests/OSF_Redshift_MemberExtractionBatchJobTst.cls-meta.xml,force-app/main/default/classes/tests/OSF_Redshift_MembershipStatusExBatchTest.cls,force-app/main/default/classes/tests/OSF_Redshift_MembershipStatusExBatchTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_Redshift_MembershipStatusTest.cls,force-app/main/default/classes/tests/OSF_Redshift_MembershipStatusTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_Redshift_MembershipTierHistBatchTest.cls,force-app/main/default/classes/tests/OSF_Redshift_MembershipTierHistBatchTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_Redshift_PointsExpiryExtBatchJobTest.cls,force-app/main/default/classes/tests/OSF_Redshift_PointsExpiryExtBatchJobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_Redshift_PointsExpiryExtracTest.cls,force-app/main/default/classes/tests/OSF_Redshift_PointsExpiryExtracTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_Redshift_PointsSpending_BatchJobTest.cls,force-app/main/default/classes/tests/OSF_Redshift_PointsSpending_BatchJobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_Redshift_PointsTransfer_BatchJobTest.cls,force-app/main/default/classes/tests/OSF_Redshift_PointsTransfer_BatchJobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_Redshift_RedemptionsExt_BatchJobTest.cls,force-app/main/default/classes/tests/OSF_Redshift_RedemptionsExt_BatchJobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_Rest_RedeemTicketExchangesTest.cls,force-app/main/default/classes/tests/OSF_Rest_RedeemTicketExchangesTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_TicketCancelationHistor_BatchJobTest.cls,force-app/main/default/classes/tests/OSF_TicketCancelationHistor_BatchJobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_TicketCancelation_BatchJobTest.cls,force-app/main/default/classes/tests/OSF_TicketCancelation_BatchJobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_TicketCheckInHistory_BatchJobTest.cls,force-app/main/default/classes/tests/OSF_TicketCheckInHistory_BatchJobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_TicketCheckIn_BatchJobTest.cls,force-app/main/default/classes/tests/OSF_TicketCheckIn_BatchJobTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_TicketSales_BatchJobSchedulerTest.cls,force-app/main/default/classes/tests/OSF_TicketSales_BatchJobSchedulerTest.cls-meta.xml,force-app/main/default/classes/tests/OSF_TicketSales_BatchJobTest.cls,force-app/main/default/classes/tests/OSF_TicketSales_BatchJobTest.cls-meta.xml,force-app/main/default/triggers/AccountTrigger.trigger,force-app/main/default/triggers/AccountTrigger.trigger-meta.xml,force-app/main/default/triggers/Compensation.trigger,force-app/main/default/triggers/Compensation.trigger-meta.xml,force-app/main/default/triggers/LoyaltyMemberTierTrigger.trigger,force-app/main/default/triggers/LoyaltyMemberTierTrigger.trigger-meta.xml,force-app/main/default/triggers/LoyaltyProgramMemberTrigger.trigger,force-app/main/default/triggers/LoyaltyProgramMemberTrigger.trigger-meta.xml"
              FILES_TO_DEPLOY=$(echo $TEST | tr ',' '\n' )
              echo $FILES_TO_DEPLOY

           #      - name: Build with Maven
#        run: mvn install "-DskipMunitBoolean=true"

#      - name: Deploy with Maven
#        run:  mvn clean deploy "-DmuleDeploy"
#                              "-Denv=Sandbox"
#                              "-DskipMunitBoolean=true"
#                              -s .maven/settings.xml
                              #"-Dap.client_id=20f8dfb151a449919157340fadcc8e41"
                              #"-Dap.client_secret=7c77704A6C544879acFcB2a17453C8be"
                              #"-Dap.analytics_base_uri=https://analytics-ingest.eu1.anypoint.mulesoft.com"
                              #"-Dap.base_uri=https://eu1.anypoint.mulesoft.com"
                              #"-Danypoint.platform.config.analytics.agent.enabled=true"                        
                              
                            